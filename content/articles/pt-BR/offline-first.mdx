---
title: "Offline first"
excerpt: "Como aplicar em React Native."
---

**Offline first** √© uma abordagem para aplicativos m√≥veis que funciona de forma semelhante independentemente da conex√£o com a internet. Para aplicar esta t√©cnica no React Native, precisamos usar algumas ferramentas.
Vamos descobrir como podemos garantir uma experi√™ncia de usu√°rio sem uma conex√£o com a internet.

## Como funciona

Antes de entrarmos na parte pr√°tica, precisamos estar na mesma p√°gina sobre como esta abordagem funciona:

- Quando o aplicativo √© iniciado, ele testa se o usu√°rio tem acesso √† internet;
- Sem acesso √† internet, todas as a√ß√µes do usu√°rio s√£o salvas em um banco de dados offline. Este banco de dados n√£o √© compartilhado entre outros usu√°rios do aplicativo;
- Assim que o usu√°rio obt√©m acesso √† internet, este banco de dados √© sincronizado com o banco de dados online. Ent√£o todas as informa√ß√µes s√£o enviadas a outros usu√°rios do aplicativo;

Veja a imagem abaixo que mostra este fluxo:

![Offline First flow](/blog/offline-first.jpg)

## Por que voc√™ deveria considerar esta abordagem?

Desenvolver seu aplicativo garantindo que seu usu√°rio sempre tenha uma conex√£o com a internet √© um grande erro.

Antes de continuar, fa√ßa o seguinte teste:

- Desative sua conex√£o com a internet
- Visite um aplicativo como Spotify, Netflix ou Uber
- Verifique se o comportamento √© semelhante ao que ter√≠amos com uma conex√£o com a internet

**Isso √© o poder do pensamento Offline First. üöÄ**

Em alguns casos, como Spotify, o usu√°rio ainda pode baixar m√∫sicas para ouvir offline, este comportamento tamb√©m √© visto no Netflix para filmes ou s√©ries.
Ao apostar nesta arquitetura, √© essencial garantir uma boa usabilidade para seu aplicativo.

**O que seu aplicativo faz quando um usu√°rio n√£o tem conex√£o com a internet?**

Se o usu√°rio n√£o puder navegar e funcionar corretamente, voc√™ pode estar perdendo muito com isso, ent√£o vamos aprender sobre algumas t√©cnicas e ferramentas para superar este comportamento e aplicar o pensamento Offline First no React Native.

## Usando em um aplicativo React Native

React Native oferece algumas alternativas para usar o pensamento Offline First.

Primeiro, precisamos cuidar de onde salvar os dados quando o usu√°rio est√° offline, para isso recomendo usar RealmDB ou WatermelonDB. Mesmo assim, se voc√™ quiser, pode usar AsyncStorage sem problemas, a √∫nica limita√ß√£o √© que neste caso voc√™ n√£o poder√° realizar nenhum tipo de filtro ou consulta nos dados gravados offline.
Agora que temos onde gravar os dados, precisamos descobrir se o usu√°rio est√° online ou n√£o. O React Native exp√µe a API nativa NetInfo que nos d√° esta informa√ß√£o.

## Usando WatermelonDB para dados complexos

Se seu aplicativo React Native √© simples e voc√™ usa servi√ßos remotos para armazenar seus dados em um banco de dados e Redux em todo o aplicativo, ent√£o react-native-offline e redux-persist funcionar√£o para voc√™.

Mas para aplicativos que s√£o de dados intensivos, esses m√©todos poder√£o atrasar seu aplicativo. Usar Redux onde n√£o √© necess√°rio √© suficiente para criar tempos de carregamento mais lentos, e ambos os pacotes requerem Redux para lidar com todos os dados online e offline.

Para aplicativos mais complexos que s√£o apoiados por um banco de dados SQL, WatermelonDB √© uma boa op√ß√£o. Com WatermelonDB, todos os dados s√£o salvos e acessados localmente em um banco de dados SQLite usando um thread nativo separado. Watermelon tamb√©m √© lazy. Ele carrega dados apenas quando s√£o necess√°rios, ent√£o as consultas s√£o resolvidas rapidamente.

WatermelonDB √© apenas um banco de dados local, mas tamb√©m fornece primitivos de sincroniza√ß√£o e adaptadores de sincroniza√ß√£o que voc√™ pode usar para sincronizar dados locais com seu banco de dados remoto.

Para usar WatermelonDB para sincronizar seus dados, voc√™ precisa criar dois endpoints de API em seu Back-end - um para enviar altera√ß√µes e outro para puxar altera√ß√µes. Voc√™ tamb√©m ter√° que criar sua pr√≥pria l√≥gica para determinar quando sincronizar este dado.

## Usando MongoDB Realm para aplicativos de dados intensivos

Se seu aplicativo de dados intensivos usa dados n√£o relacionais, ent√£o WatermelonDB pode n√£o ser a melhor solu√ß√£o. MongoDB Realm pode ser uma solu√ß√£o melhor. O banco de dados Realm √© um banco de dados NoSQL local que voc√™ pode usar no seu aplicativo React Native. Ele pode ser integrado com MongoDB Atlas.

Se voc√™ optar por usar Realm, ent√£o criar um aplicativo React Native √© relativamente simples usando o SDK React Native do MongoDB Realm. Realm tem gerenciamento de usu√°rios integrado que permite a cria√ß√£o e autentica√ß√£o de usu√°rios em dispositivos usando uma variedade de provedores de autentica√ß√£o, incluindo email/senha, JWT, Facebook, Google e Apple. Se voc√™ optar por sincronizar seus dados com um MongoDB que est√° hospedado na nuvem, essa funcionalidade tamb√©m est√° integrada ao SDK.

## Conclus√£o

Criar um aplicativo sem pensar na sua usabilidade offline √© muito prejudicial. Esta abordagem ajuda muito neste momento.
Usando as t√©cnicas e ferramentas mencionadas neste post, voc√™ provavelmente obter√° o comportamento necess√°rio no seu aplicativo.
